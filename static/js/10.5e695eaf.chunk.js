(this["webpackJsonpmanagement-done"]=this["webpackJsonpmanagement-done"]||[]).push([[10],{431:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return se})),t.d(n,"useDragEnd",(function(){return be})),t.d(n,"ColumnsContainer",(function(){return je}));var r,a,c,i=t(96),d=t(97),o=t(0),u=t.n(o),s=t(34),b=t(443),j=t(445),l=t(20),O=t(110),f=t(173),v=t(426),m=t(417),p=t(419),x=function(){var e,n=null===(e=Object(l.g)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(n)},h=function(){return{projectId:x()}},k=function(){return["schedules",h()]},g=function(){var e=Object(p.b)(["name","typeId","processorId","tagId"]),n=Object(s.a)(e,1)[0],t=x(),r=Object(O.d)(n.name,500);return Object(o.useMemo)((function(){return{projectId:t,typeId:Number(n.typeId)||void 0,processorId:Number(n.processorId)||void 0,tagId:Number(n.tagId)||void 0,name:r}}),[t,n,r])},y=function(){return["tasks",g()]},I=function(e){var n=Object(f.b)();return Object(b.a)(["schedules",e],(function(){return n("Kanbans",{query:e})}))},T=function(e){var n=Object(f.b)();return Object(b.a)(["tasks",e],(function(){return n("tasks",{query:e})}))},C=function(){var e=Object(f.b)();return Object(b.a)(["taskTypes"],(function(){return e("taskTypes")}))},E=function(){var e=Object(p.b)(["editTask"]),n=Object(s.a)(e,2),t=n[0].editTask,r=n[1],a=function(e){var n=Object(f.b)();return Object(b.a)(["task",{id:e}],(function(){return n("tasks/".concat(e))}),{enabled:Boolean(e)})}(Number(t)),c=a.data,i=a.isLoading;return{editTask:t,Task:c,startEdit:Object(o.useCallback)((function(e){r({editTask:e})}),[r]),endEdit:Object(o.useCallback)((function(){r({editTask:""})}),[r]),isLoading:i}},w=t(423),N=t(77),L=t(413),P=t(148),S=t(418),q=t(43),F=t(421),A=t(28),R=function(e){var n=C().data;return Object(A.jsx)(F.a,Object(q.a)({options:n||[]},e))},z=function(){var e=g(),n=Object(p.a)();return Object(A.jsxs)(N.e,{marginBottom:4,gap:!0,children:[Object(A.jsx)(L.a,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:e.name,onChange:function(e){return n({name:e.target.value})}}),Object(A.jsx)(S.a,{defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:function(e){return n({processorId:e})}}),Object(A.jsx)(R,{defaultOptionName:"\u7c7b\u578b",value:e.typeId,onChange:function(e){return n({typeId:e})}}),Object(A.jsx)(P.a,{onClick:function(){n({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u6e05\u9664\u7b5b\u9009\u5668"})]})},D=t(165),V=t(170),B=function(e){var n=e.children,t=Object(V.a)(e,["children"]);return Object(A.jsx)(w.c,Object(q.a)(Object(q.a)({},t),{},{children:function(e){return u.a.isValidElement(n)?u.a.cloneElement(n,Object(q.a)(Object(q.a)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):Object(A.jsx)("div",{})}}))},H=u.a.forwardRef((function(e,n){var t,r=e.children,a=Object(V.a)(e,["children"]);return Object(A.jsxs)("div",Object(q.a)(Object(q.a)({ref:n},a),{},{children:[r,null===(t=a.provided)||void 0===t?void 0:t.placeholder]}))})),K=function(e){var n=e.children,t=Object(V.a)(e,["children"]);return Object(A.jsx)(w.b,Object(q.a)(Object(q.a)({},t),{},{children:function(e){return u.a.isValidElement(n)?u.a.cloneElement(n,Object(q.a)(Object(q.a)(Object(q.a)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef})):Object(A.jsx)("div",{})}}))},M=t.p+"static/media/task.8118694e.svg",J=t.p+"static/media/bug.bc7dca9d.svg",U=t(433),W=t(438),G=t(424),Q=t(425),X=t(19),Y=t.n(X),Z=t(50),$=function(){var e=Object(o.useState)(""),n=Object(s.a)(e,2),t=n[0],r=n[1],a=x(),c=function(e){var n=Object(f.b)();return Object(j.a)((function(e){return n("kanbans",{query:e,method:"POST"})}),Object(v.a)(e))}(k()).mutateAsync,i=function(){var e=Object(Z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({name:t,projectId:a});case 2:r("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(A.jsx)(ce,{children:Object(A.jsx)(L.a,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:i,value:t,onChange:function(e){return r(e.target.value)}})})},_=function(e){var n=e.kanbanId,t=Object(o.useState)(""),r=Object(s.a)(t,2),a=r[0],c=r[1],i=function(e){var n=Object(f.b)();return Object(j.a)((function(e){return n("tasks",{query:e,method:"POST"})}),Object(v.a)(e))}(y()).mutateAsync,d=x(),u=Object(o.useState)(!1),b=Object(s.a)(u,2),l=b[0],O=b[1],m=function(){var e=Object(Z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({projectId:d,name:a,kanbanId:n});case 2:O(!1),c("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){return O((function(e){return!e}))};return Object(o.useEffect)((function(){l||c("")}),[l]),l?Object(A.jsx)(U.a,{children:Object(A.jsx)(L.a,{onBlur:p,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:m,value:a,onChange:function(e){return c(e.target.value)}})}):Object(A.jsx)("div",{onClick:p,children:"+\u521b\u5efa\u4e8b\u52a1"})},ee=function(e){var n,t=e.id,r=C().data,a=null===r||void 0===r||null===(n=r.find((function(e){return e.id===t})))||void 0===n?void 0:n.name;return a?Object(A.jsx)("img",{alt:"task"===a?"task-icon":"bug-icon",src:"task"===a?M:J}):null},ne=function(e){var n=e.task,t=E().startEdit,r=g().name;return Object(A.jsxs)(U.a,{onClick:function(){return t(n.id)},style:{margin:"0.25rem",cursor:"pointer"},children:[Object(A.jsx)("p",{children:Object(A.jsx)(ae,{keyword:r,name:n.name})}),Object(A.jsx)(ee,{id:n.typeId})]},n.id)},te=u.a.forwardRef((function(e,n){var t=e.kanban,r=Object(V.a)(e,["kanban"]),a=T(g()).data,c=null===a||void 0===a?void 0:a.filter((function(e){return e.kanbanId===t.id}));return Object(A.jsxs)(ce,Object(q.a)(Object(q.a)({},r),{},{ref:n,children:[Object(A.jsxs)(N.e,{between:!0,children:[Object(A.jsx)("h3",{children:t.name}),Object(A.jsx)(re,{kanban:t},t.id)]}),Object(A.jsxs)(ie,{children:[Object(A.jsx)(B,{type:"ROW",direction:"vertical",droppableId:String(t.id),children:Object(A.jsx)(H,{style:{minHeight:"1rem"},children:null===c||void 0===c?void 0:c.map((function(e,n){return Object(A.jsx)(K,{index:n,draggableId:"task"+e.id,children:Object(A.jsx)("div",{children:Object(A.jsx)(ne,{task:e},e.id)})},e.id)}))})}),Object(A.jsx)(_,{kanbanId:t.id})]})]}))})),re=function(e){var n=e.kanban,t=function(e){var n=Object(f.b)();return Object(j.a)((function(e){var t=e.id;return n("kanbans/".concat(t),{method:"DELETE"})}),Object(v.b)(e))}(k()).mutateAsync,r=Object(A.jsx)(G.a,{children:Object(A.jsx)(G.a.Item,{children:Object(A.jsx)(P.a,{type:"link",onClick:function(){W.a.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return t({id:n.id})}})},children:"\u5220\u9664"})})});return Object(A.jsx)(Q.a,{overlay:r,children:Object(A.jsx)(P.a,{type:"link",children:"..."})})},ae=function(e){var n=e.name,t=e.keyword;if(!t)return Object(A.jsx)(A.Fragment,{children:n});var r=n.split(t);return Object(A.jsx)(A.Fragment,{children:r.map((function(e,n){return Object(A.jsxs)("span",{children:[e,n===r.length-1?null:Object(A.jsx)("span",{style:{color:"#257AFD"},children:t})]},n)}))})},ce=d.a.div(r||(r=Object(i.a)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"]))),ie=d.a.div(a||(a=Object(i.a)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),de=t(412),oe={labelCol:{span:8},wrapperCol:{span:16}},ue=function(){var e=de.a.useForm(),n=Object(s.a)(e,1)[0],t=E(),r=t.editTask,a=t.Task,c=t.endEdit,i=function(e){var n=Object(f.b)();return Object(j.a)((function(e){return n("tasks/".concat(e.id),{method:"PATCH",query:e})}),Object(v.c)(e))}(y()),d=i.mutateAsync,u=i.isLoading,b=function(e){var n=Object(f.b)();return Object(j.a)((function(e){var t=e.id;return n("tasks/".concat(t),{method:"DELETE"})}),Object(v.b)(e))}(y()).mutate,l=function(){var e=Object(Z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(Object(q.a)(Object(q.a)({},a),n.getFieldsValue()));case 2:c();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(o.useEffect)((function(){n.setFieldsValue(a)}),[n,a]),Object(A.jsxs)(W.a,{forceRender:!0,onCancel:function(){c(),n.resetFields()},onOk:l,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:u,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!r,children:[Object(A.jsxs)(de.a,Object(q.a)(Object(q.a)({},oe),{},{initialValues:a,form:n,children:[Object(A.jsx)(de.a.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:Object(A.jsx)(L.a,{})}),Object(A.jsx)(de.a.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:Object(A.jsx)(S.a,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),Object(A.jsx)(de.a.Item,{label:"\u7c7b\u578b",name:"typeId",children:Object(A.jsx)(R,{})})]})),Object(A.jsx)("div",{style:{textAlign:"right"},children:Object(A.jsx)(P.a,{onClick:function(){c(),W.a.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return b({id:Number(r)})}})},style:{fontSize:"14px"},size:"small",children:"\u5220\u9664"})})]})};function se(){Object(O.e)("\u770b\u677f\u5217\u8868");var e=Object(m.e)(x()).data,n=I(h()),t=n.data,r=n.isLoading,a=T(g()).isLoading||r,c=be();return Object(A.jsx)(w.a,{onDragEnd:c,children:Object(A.jsxs)(N.f,{children:[Object(A.jsxs)("h1",{children:[null===e||void 0===e?void 0:e.name,"\u770b\u677f"]}),Object(A.jsx)(z,{}),a?Object(A.jsx)(D.a,{size:"large"}):Object(A.jsxs)(je,{children:[Object(A.jsx)(B,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:Object(A.jsx)(H,{style:{display:"flex"},children:null===t||void 0===t?void 0:t.map((function(e,n){return Object(A.jsx)(K,{draggableId:"kanban"+e.id,index:n,children:Object(A.jsx)(te,{kanban:e},e.id)},e.id)}))})}),Object(A.jsx)($,{})]}),Object(A.jsx)(ue,{})]})})}var be=function(){var e=I(h()).data,n=T(g()).data,t=void 0===n?[]:n,r=function(e){var n=Object(f.b)();return Object(j.a)((function(e){return n("kanbans/reorder",{query:e,method:"POST"})}),Object(v.d)(e))}(k()).mutate,a=function(e){var n=Object(f.b)();return Object(j.a)((function(e){return n("tasks/reorder",{query:e,method:"POST"})}),Object(v.e)(e))}(y()).mutate;return Object(o.useCallback)((function(n){var c=n.source,i=n.destination,d=n.type;if(i){if("COLUMN"===d){var o=null===e||void 0===e?void 0:e[c.index].id,u=null===e||void 0===e?void 0:e[i.index].id;if(!o||!u||o===u)return;var s=i.index>c.index?"after":"before";r({fromId:o,referenceId:u,type:s})}if("ROW"===d){var b=+c.droppableId,j=+i.droppableId,l=t.filter((function(e){return e.kanbanId===b}))[c.index],O=t.filter((function(e){return e.kanbanId===j}))[i.index];if((null===l||void 0===l?void 0:l.id)===(null===O||void 0===O?void 0:O.id))return;a({fromId:null===l||void 0===l?void 0:l.id,referenceId:null===O||void 0===O?void 0:O.id,fromKanbanId:b,toKanbanId:j,type:b===j&&i.index>c.index?"after":"before"})}}}),[e,t,r,a])},je=d.a.div(c||(c=Object(i.a)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n  min-height: 50vh;\n"])))}}]);